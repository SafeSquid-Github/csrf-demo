# CSRF Attack Simulator

## Scenario

Imagine this:

1. You log into your online banking account. Unfortunately, the application lacks sufficient security measures against CSRF (Cross-Site Request Forgery) attacks. There's a vulnerable form on the website that could be exploited to change the phone number associated with your account.
2. While browsing social media, your friend shares a link to what looks like a simple registration form for a hiking trip. You click the seemingly harmless link.
3. Unbeknownst to you, the hiking trip website contains a hidden iframe with a form that automatically submits as soon as the page loads. This form sends a request to the banking application's backend, changing the phone number associated with your bank account. It does this by taking advantage of the cookies stored from your banking session, which authenticate the request without your consent or knowledge.

## Project Structure

This project consists of two Express applications that demonstrate a Cross-Site Request Forgery (CSRF) attack:

1. **Vulnerable Banking Application** (`bankease.com`): A simple banking app with login, a dashboard, and a profile page where a user can update their personal information.
2. **Attacker Application** (`hiking.com`): A malicious site disguised as a hiking registration form that silently submits a cross-origin request to the banking app to update the user's profile without their knowledge.

This setup shows how a CSRF attack can exploit vulnerabilities in a web application that does not implement proper CSRF protection.

## Setup

### Prerequisites

- [Node.js](https://nodejs.org/) (v14 or higher)
- npm (Node Package Manager)
- Docker

### Installation

1. **Clone the Repository:**

   ```bash
   git clone https://github.com/SafeSquid-GitHub/bank-ease.git csrf-demo
   cd csrf-demo
   ```

2. **Run the Applications:**

   - Start the applications using Docker Compose:

     ```bash
     docker compose up    # use the --build flag when running for the first time
     ```

   - Import the root certificate in your browser to access the applications over HTTPS. The root certificate is generated by Caddy and stored in the `caddy_data/data/caddy/pki/authorities/local/root.crt` file.

     - **Chrome:**

       - Open Chrome and go to `chrome://settings/security`.
       - Click on "Manage certificates".
       - Go to the "Trusted Root Certification Authorities" tab and click on "Import".
       - Select the `root.crt` file from the `caddy_data/data/caddy/pki/authorities/local/` directory.
       - Click "Next" > "Next" > "Finish".

     - **Firefox:**

       - Open Firefox and go to `about:preferences#privacy`.
       - Scroll down to the "Certificates" section and click on "View Certificates".
       - Go to the "Authorities" tab and click on "Import".
       - Select the `root.crt` file from the `caddy_data/data/caddy/pki/authorities/local/` directory.
       - Check all the boxes and click "OK".

3. **Finally, Edit the Local DNS file:**

   - Add the following entries to your `/etc/hosts` or (`C:\Windows\System32\drivers\etc\hosts` for Windows) file:

     ```
     127.0.0.1 bankease.com
     127.0.0.1 hiking.com
     ```

## Application Details

#### Vulnerable Banking Application (`bankease.com`)

This app simulates a simple banking system with user login, dashboard, and profile functionality. It lacks CSRF protection, making it vulnerable to attacks.

1. **Login Page:**

   - Accessible at `https://bankease.com/login`
   - Use the following credentials:
     - Username: `user@safesquid.net`
     - Password: `secret`

   After login, the user is redirected to the dashboard.

2. **Dashboard Page:**

   - Accessible at `https://bankease.com/`
   - Displays a basic statistics and links to the profile page if the user is authenticated.

3. **Profile Page:**
   - Accessible at `https://bankease.com/profile`
   - Allows the logged-in user to update their profile detailss.

#### Attacker Application (`https://hiking.com`)

The attacker app simulates a malicious website that performs a CSRF attack on the banking app.

1. **Hiking Registration Form (Malicious Page):**

   - Accessible at `https://hiking.com`
   - Displays a fake hiking registration form, which has no real functionality.
   - Contains a hidden form that submits a POST request to `https://bankease.com/profile`, changing the mobile number of the logged-in user in the banking app.

2. **CSRF Attack Mechanism:**
   - The hidden form is auto-submitted in an invisible iframe to avoid redirecting the user to the banking app.
   - This attack leverages the fact that the browser automatically includes session cookies for the vulnerable domain (`https://bankease.com`) in the form submission, allowing the attack to succeed.

## How to Test the CSRF Attack

1. **Login to the Banking App:**

   - Visit `https://bankease.com/login` and log in using the credentials:
     - Username: `user@safesquid.net`
     - Password: `secret`

2. **View Profile:**

   - Go to `https://bankease.com/profile` to see the current email and mobile number of the user.

3. **Trigger the CSRF Attack:**

   - Open `https://hiking.com` in another browser tab.
   - You will see a hiking trip registration form, but in the background, your mobile number will be updated in the banking app due to the hidden form submission.

4. **Verify Profile Update:**
   - Go back to `https://bankease.com/profile` and refresh the page. You will see that the mobile number has been changed to `+91 99999 99999` without your input.

**Note:** If the CSRF attack simulation doesn't work, ensure that cross-site cookies are enabled in your browser settings. I recommend using Google Chrome for the simulation, as it tends to allow cross-site cookies more freely by default, making it ideal for testing this simulation.
